"use strict";(self.webpackChunk_antv_l7_editor=self.webpackChunk_antv_l7_editor||[]).push([[433],{46705:function(Q,E,h){h.r(E),h.d(E,{default:function(){return Ge}});var L=h(10574),W=h.n(L),O=h(39343),X=h.n(O),Y=h(17108),u=h(32290),g=h(77617),F=h(35894),G=function(e,r){var n=r.manual,t=r.ready,a=t===void 0?!0:t,o=r.defaultParams,s=o===void 0?[]:o,c=r.refreshDeps,l=c===void 0?[]:c,i=r.refreshDepsAction,m=(0,g.useRef)(!1);return m.current=!1,(0,F.Z)(function(){!n&&a&&(m.current=!0,e.run.apply(e,(0,u.ev)([],(0,u.CR)(s),!1)))},[a]),(0,F.Z)(function(){m.current||n||(m.current=!0,i?i():e.refresh())},(0,u.ev)([],(0,u.CR)(l),!1)),{onBefore:function(){if(!a)return{stopNow:!0}}}};G.onInit=function(e){var r=e.ready,n=r===void 0?!0:r,t=e.manual;return{loading:!t&&n}};var I=G,q=h(36596);function z(e,r){var n=(0,g.useRef)({deps:r,obj:void 0,initialized:!1}).current;return(n.initialized===!1||!(0,q.Z)(n.deps,r))&&(n.deps=r,n.obj=e(),n.initialized=!0),n.obj}var B=h(22633),P=new Map,k=function(e,r,n){var t=P.get(e);t!=null&&t.timer&&clearTimeout(t.timer);var a=void 0;r>-1&&(a=setTimeout(function(){P.delete(e)},r)),P.set(e,(0,u.pi)((0,u.pi)({},n),{timer:a}))},_=function(e){return P.get(e)},ze=function(e){if(e){var r=Array.isArray(e)?e:[e];r.forEach(function(n){return P.delete(n)})}else P.clear()},Z=new Map,ee=function(e){return Z.get(e)},ne=function(e,r){Z.set(e,r),r.then(function(n){return Z.delete(e),n}).catch(function(){Z.delete(e)})},y={},re=function(e,r){y[e]&&y[e].forEach(function(n){return n(r)})},x=function(e,r){return y[e]||(y[e]=[]),y[e].push(r),function(){var t=y[e].indexOf(r);y[e].splice(t,1)}},te=function(e,r){var n=r.cacheKey,t=r.cacheTime,a=t===void 0?5*60*1e3:t,o=r.staleTime,s=o===void 0?0:o,c=r.setCache,l=r.getCache,i=(0,g.useRef)(),m=(0,g.useRef)(),d=function(f,v){c?c(v):k(f,a,v),re(f,v.data)},p=function(f,v){return v===void 0&&(v=[]),l?l(v):_(f)};return z(function(){if(n){var f=p(n);f&&Object.hasOwnProperty.call(f,"data")&&(e.state.data=f.data,e.state.params=f.params,(s===-1||new Date().getTime()-f.time<=s)&&(e.state.loading=!1)),i.current=x(n,function(v){e.setState({data:v})})}},[]),(0,B.Z)(function(){var f;(f=i.current)===null||f===void 0||f.call(i)}),n?{onBefore:function(f){var v=p(n,f);return!v||!Object.hasOwnProperty.call(v,"data")?{}:s===-1||new Date().getTime()-v.time<=s?{loading:!1,data:v==null?void 0:v.data,error:void 0,returnNow:!0}:{data:v==null?void 0:v.data,error:void 0}},onRequest:function(f,v){var R=ee(n);return R&&R!==m.current?{servicePromise:R}:(R=f.apply(void 0,(0,u.ev)([],(0,u.CR)(v),!1)),m.current=R,ne(n,R),{servicePromise:R})},onSuccess:function(f,v){var R;n&&((R=i.current)===null||R===void 0||R.call(i),d(n,{data:f,params:v,time:new Date().getTime()}),i.current=x(n,function(j){e.setState({data:j})}))},onMutate:function(f){var v;n&&((v=i.current)===null||v===void 0||v.call(i),d(n,{data:f,params:e.state.params,time:new Date().getTime()}),i.current=x(n,function(R){e.setState({data:R})}))}}:{}},ie=te,ae=h(41571),ue=h.n(ae),oe=function(e,r){var n=r.debounceWait,t=r.debounceLeading,a=r.debounceTrailing,o=r.debounceMaxWait,s=(0,g.useRef)(),c=(0,g.useMemo)(function(){var l={};return t!==void 0&&(l.leading=t),a!==void 0&&(l.trailing=a),o!==void 0&&(l.maxWait=o),l},[t,a,o]);return(0,g.useEffect)(function(){if(n){var l=e.runAsync.bind(e);return s.current=ue()(function(i){i()},n,c),e.runAsync=function(){for(var i=[],m=0;m<arguments.length;m++)i[m]=arguments[m];return new Promise(function(d,p){var f;(f=s.current)===null||f===void 0||f.call(s,function(){l.apply(void 0,(0,u.ev)([],(0,u.CR)(i),!1)).then(d).catch(p)})})},function(){var i;(i=s.current)===null||i===void 0||i.cancel(),e.runAsync=l}}},[n,c]),n?{onCancel:function(){var l;(l=s.current)===null||l===void 0||l.cancel()}}:{}},se=oe,le=function(e,r){var n=r.loadingDelay,t=r.ready,a=(0,g.useRef)();if(!n)return{};var o=function(){a.current&&clearTimeout(a.current)};return{onBefore:function(){return o(),t!==!1&&(a.current=setTimeout(function(){e.setState({loading:!0})},n)),{loading:!1}},onFinally:function(){o()},onCancel:function(){o()}}},ce=le,M=h(15511);function H(){return M.Z?document.visibilityState!=="hidden":!0}var A=[];function fe(e){return A.push(e),function(){var n=A.indexOf(e);A.splice(n,1)}}if(M.Z){var ve=function(){if(H())for(var e=0;e<A.length;e++){var r=A[e];r()}};window.addEventListener("visibilitychange",ve,!1)}var de=fe,he=function(e,r){var n=r.pollingInterval,t=r.pollingWhenHidden,a=t===void 0?!0:t,o=r.pollingErrorRetryCount,s=o===void 0?-1:o,c=(0,g.useRef)(),l=(0,g.useRef)(),i=(0,g.useRef)(0),m=function(){var d;c.current&&clearTimeout(c.current),(d=l.current)===null||d===void 0||d.call(l)};return(0,F.Z)(function(){n||m()},[n]),n?{onBefore:function(){m()},onError:function(){i.current+=1},onSuccess:function(){i.current=0},onFinally:function(){s===-1||s!==-1&&i.current<=s?c.current=setTimeout(function(){!a&&!H()?l.current=de(function(){e.refresh()}):e.refresh()},n):i.current=0},onCancel:function(){m()}}:{}},me=he;function ge(e,r){var n=!1;return function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];n||(n=!0,e.apply(void 0,(0,u.ev)([],(0,u.CR)(t),!1)),setTimeout(function(){n=!1},r))}}function pe(){return M.Z&&typeof navigator.onLine!="undefined"?navigator.onLine:!0}var S=[];function Re(e){return S.push(e),function(){var n=S.indexOf(e);n>-1&&S.splice(n,1)}}if(M.Z){var V=function(){if(!(!H()||!pe()))for(var e=0;e<S.length;e++){var r=S[e];r()}};window.addEventListener("visibilitychange",V,!1),window.addEventListener("focus",V,!1)}var ye=Re,be=function(e,r){var n=r.refreshOnWindowFocus,t=r.focusTimespan,a=t===void 0?5e3:t,o=(0,g.useRef)(),s=function(){var c;(c=o.current)===null||c===void 0||c.call(o)};return(0,g.useEffect)(function(){if(n){var c=ge(e.refresh.bind(e),a);o.current=ye(function(){c()})}return function(){s()}},[n,a]),(0,B.Z)(function(){s()}),{}},Ce=be,Pe=function(e,r){var n=r.retryInterval,t=r.retryCount,a=(0,g.useRef)(),o=(0,g.useRef)(0),s=(0,g.useRef)(!1);return t?{onBefore:function(){s.current||(o.current=0),s.current=!1,a.current&&clearTimeout(a.current)},onSuccess:function(){o.current=0},onError:function(){if(o.current+=1,t===-1||o.current<=t){var c=n!=null?n:Math.min(1e3*Math.pow(2,o.current),3e4);a.current=setTimeout(function(){s.current=!0,e.refresh()},c)}else o.current=0},onCancel:function(){o.current=0,a.current&&clearTimeout(a.current)}}:{}},Te=Pe,Ee=h(46700),Ae=h.n(Ee),Se=function(e,r){var n=r.throttleWait,t=r.throttleLeading,a=r.throttleTrailing,o=(0,g.useRef)(),s={};return t!==void 0&&(s.leading=t),a!==void 0&&(s.trailing=a),(0,g.useEffect)(function(){if(n){var c=e.runAsync.bind(e);return o.current=Ae()(function(l){l()},n,s),e.runAsync=function(){for(var l=[],i=0;i<arguments.length;i++)l[i]=arguments[i];return new Promise(function(m,d){var p;(p=o.current)===null||p===void 0||p.call(o,function(){c.apply(void 0,(0,u.ev)([],(0,u.CR)(l),!1)).then(m).catch(d)})})},function(){var l;e.runAsync=c,(l=o.current)===null||l===void 0||l.cancel()}}},[n,t,a]),n?{onCancel:function(){var c;(c=o.current)===null||c===void 0||c.cancel()}}:{}},De=Se,Oe=h(30542),T=h(70801),Ze=h(3957),Me=function(){var e=(0,u.CR)((0,g.useState)({}),2),r=e[1];return(0,g.useCallback)(function(){return r({})},[])},je=Me,we=h(37036),Le=h(73680),We=function(){function e(r,n,t,a){a===void 0&&(a={}),this.serviceRef=r,this.options=n,this.subscribe=t,this.initState=a,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=(0,u.pi)((0,u.pi)((0,u.pi)({},this.state),{loading:!n.manual}),a)}return e.prototype.setState=function(r){r===void 0&&(r={}),this.state=(0,u.pi)((0,u.pi)({},this.state),r),this.subscribe()},e.prototype.runPluginHandler=function(r){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var a=this.pluginImpls.map(function(o){var s;return(s=o[r])===null||s===void 0?void 0:s.call.apply(s,(0,u.ev)([o],(0,u.CR)(n),!1))}).filter(Boolean);return Object.assign.apply(Object,(0,u.ev)([{}],(0,u.CR)(a),!1))},e.prototype.runAsync=function(){for(var r,n,t,a,o,s,c,l,i,m,d=[],p=0;p<arguments.length;p++)d[p]=arguments[p];return(0,u.mG)(this,void 0,void 0,function(){var f,v,R,j,N,K,U,w,b,C,J;return(0,u.Jh)(this,function(D){switch(D.label){case 0:if(this.count+=1,f=this.count,v=this.runPluginHandler("onBefore",d),R=v.stopNow,j=R===void 0?!1:R,N=v.returnNow,K=N===void 0?!1:N,U=(0,u._T)(v,["stopNow","returnNow"]),j)return[2,new Promise(function(){})];if(this.setState((0,u.pi)({loading:!0,params:d},U)),K)return[2,Promise.resolve(U.data)];(n=(r=this.options).onBefore)===null||n===void 0||n.call(r,d),D.label=1;case 1:return D.trys.push([1,3,,4]),w=this.runPluginHandler("onRequest",this.serviceRef.current,d).servicePromise,w||(w=(J=this.serviceRef).current.apply(J,(0,u.ev)([],(0,u.CR)(d),!1))),[4,w];case 2:return b=D.sent(),f!==this.count?[2,new Promise(function(){})]:(this.setState({data:b,error:void 0,loading:!1}),(a=(t=this.options).onSuccess)===null||a===void 0||a.call(t,b,d),this.runPluginHandler("onSuccess",b,d),(s=(o=this.options).onFinally)===null||s===void 0||s.call(o,d,b,void 0),f===this.count&&this.runPluginHandler("onFinally",d,b,void 0),[2,b]);case 3:if(C=D.sent(),f!==this.count)return[2,new Promise(function(){})];throw this.setState({error:C,loading:!1}),(l=(c=this.options).onError)===null||l===void 0||l.call(c,C,d),this.runPluginHandler("onError",C,d),(m=(i=this.options).onFinally)===null||m===void 0||m.call(i,d,void 0,C),f===this.count&&this.runPluginHandler("onFinally",d,void 0,C),C;case 4:return[2]}})})},e.prototype.run=function(){for(var r=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];this.runAsync.apply(this,(0,u.ev)([],(0,u.CR)(n),!1)).catch(function(a){r.options.onError||console.error(a)})},e.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},e.prototype.refresh=function(){this.run.apply(this,(0,u.ev)([],(0,u.CR)(this.state.params||[]),!1))},e.prototype.refreshAsync=function(){return this.runAsync.apply(this,(0,u.ev)([],(0,u.CR)(this.state.params||[]),!1))},e.prototype.mutate=function(r){var n=(0,Le.mf)(r)?r(this.state.data):r;this.runPluginHandler("onMutate",n),this.setState({data:n})},e}(),Fe=We;function Be(e,r,n){r===void 0&&(r={}),n===void 0&&(n=[]);var t=r.manual,a=t===void 0?!1:t,o=(0,u._T)(r,["manual"]);we.Z&&r.defaultParams&&!Array.isArray(r.defaultParams)&&console.warn("expected defaultParams is array, got ".concat(typeof r.defaultParams));var s=(0,u.pi)({manual:a},o),c=(0,Oe.Z)(e),l=je(),i=z(function(){var m=n.map(function(d){var p;return(p=d==null?void 0:d.onInit)===null||p===void 0?void 0:p.call(d,s)}).filter(Boolean);return new Fe(c,s,l,Object.assign.apply(Object,(0,u.ev)([{}],(0,u.CR)(m),!1)))},[]);return i.options=s,i.pluginImpls=n.map(function(m){return m(i,s)}),(0,Ze.Z)(function(){if(!a){var m=i.state.params||r.defaultParams||[];i.run.apply(i,(0,u.ev)([],(0,u.CR)(m),!1))}}),(0,B.Z)(function(){i.cancel()}),{loading:i.state.loading,data:i.state.data,error:i.state.error,params:i.state.params||[],cancel:(0,T.Z)(i.cancel.bind(i)),refresh:(0,T.Z)(i.refresh.bind(i)),refreshAsync:(0,T.Z)(i.refreshAsync.bind(i)),run:(0,T.Z)(i.run.bind(i)),runAsync:(0,T.Z)(i.runAsync.bind(i)),mutate:(0,T.Z)(i.mutate.bind(i))}}var xe=Be;function He(e,r,n){return xe(e,r,(0,u.ev)((0,u.ev)([],(0,u.CR)(n||[]),!1),[se,ce,me,Ce,De,I,ie,Te],!1))}var Ne=He,Ue=Ne,$=h(32648),Ge=function(){var e=Ue(X()(W()().mark(function a(){var o,s;return W()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,fetch("https://ip.useragentinfo.com/json").then(function(i){return i.json()});case 2:return o=l.sent,s=o.short_name,l.abrupt("return",s==="CN");case 5:case"end":return l.stop()}},a)}))),r=e.loading,n=e.data,t=n===void 0?!0:n;return(0,$.jsx)("div",{className:"editor",children:!r&&(0,$.jsx)(Y.L7Editor,{baseMap:t?"Gaode":"Mapbox",locale:t?"zh-CN":"en-US",coordConvert:t?"GCJ02":"WGS84",mapControl:t?void 0:{administrativeSelectControl:!1,locationSearchControl:!1,mapAdministrativeControl:!1}})})}},47859:function(Q,E,h){h.r(E);var L=h(17108),W=h(77617),O=h(32648);E.default=function(){return(0,O.jsx)("div",{style:{height:800},children:(0,O.jsx)(L.L7Editor,{})})}}}]);
