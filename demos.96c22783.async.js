"use strict";(self.webpackChunk_antv_l7_editor=self.webpackChunk_antv_l7_editor||[]).push([[433],{42250:function(Q,E,h){h.r(E),h.d(E,{default:function(){return Ge}});var L=h(10574),W=h.n(L),O=h(39343),X=h.n(O),Y=h(17108),u=h(32290),g=h(77617),F=h(35894),G=function(e,r){var n=r.manual,i=r.ready,a=i===void 0?!0:i,o=r.defaultParams,s=o===void 0?[]:o,l=r.refreshDeps,c=l===void 0?[]:l,t=r.refreshDepsAction,m=(0,g.useRef)(!1);return m.current=!1,(0,F.Z)(function(){!n&&a&&(m.current=!0,e.run.apply(e,(0,u.ev)([],(0,u.CR)(s),!1)))},[a]),(0,F.Z)(function(){m.current||n||(m.current=!0,t?t():e.refresh())},(0,u.ev)([],(0,u.CR)(c),!1)),{onBefore:function(){if(!a)return{stopNow:!0}}}};G.onInit=function(e){var r=e.ready,n=r===void 0?!0:r,i=e.manual;return{loading:!i&&n}};var I=G,q=h(36596);function z(e,r){var n=(0,g.useRef)({deps:r,obj:void 0,initialized:!1}).current;return(n.initialized===!1||!(0,q.Z)(n.deps,r))&&(n.deps=r,n.obj=e(),n.initialized=!0),n.obj}var B=h(22633),P=new Map,k=function(e,r,n){var i=P.get(e);i!=null&&i.timer&&clearTimeout(i.timer);var a=void 0;r>-1&&(a=setTimeout(function(){P.delete(e)},r)),P.set(e,(0,u.pi)((0,u.pi)({},n),{timer:a}))},_=function(e){return P.get(e)},ze=function(e){if(e){var r=Array.isArray(e)?e:[e];r.forEach(function(n){return P.delete(n)})}else P.clear()},Z=new Map,ee=function(e){return Z.get(e)},ne=function(e,r){Z.set(e,r),r.then(function(n){return Z.delete(e),n}).catch(function(){Z.delete(e)})},y={},re=function(e,r){y[e]&&y[e].forEach(function(n){return n(r)})},x=function(e,r){return y[e]||(y[e]=[]),y[e].push(r),function(){var i=y[e].indexOf(r);y[e].splice(i,1)}},te=function(e,r){var n=r.cacheKey,i=r.cacheTime,a=i===void 0?5*60*1e3:i,o=r.staleTime,s=o===void 0?0:o,l=r.setCache,c=r.getCache,t=(0,g.useRef)(),m=(0,g.useRef)(),d=function(f,v){l?l(v):k(f,a,v),re(f,v.data)},p=function(f,v){return v===void 0&&(v=[]),c?c(v):_(f)};return z(function(){if(n){var f=p(n);f&&Object.hasOwnProperty.call(f,"data")&&(e.state.data=f.data,e.state.params=f.params,(s===-1||new Date().getTime()-f.time<=s)&&(e.state.loading=!1)),t.current=x(n,function(v){e.setState({data:v})})}},[]),(0,B.Z)(function(){var f;(f=t.current)===null||f===void 0||f.call(t)}),n?{onBefore:function(f){var v=p(n,f);return!v||!Object.hasOwnProperty.call(v,"data")?{}:s===-1||new Date().getTime()-v.time<=s?{loading:!1,data:v==null?void 0:v.data,error:void 0,returnNow:!0}:{data:v==null?void 0:v.data,error:void 0}},onRequest:function(f,v){var R=ee(n);return R&&R!==m.current?{servicePromise:R}:(R=f.apply(void 0,(0,u.ev)([],(0,u.CR)(v),!1)),m.current=R,ne(n,R),{servicePromise:R})},onSuccess:function(f,v){var R;n&&((R=t.current)===null||R===void 0||R.call(t),d(n,{data:f,params:v,time:new Date().getTime()}),t.current=x(n,function(j){e.setState({data:j})}))},onMutate:function(f){var v;n&&((v=t.current)===null||v===void 0||v.call(t),d(n,{data:f,params:e.state.params,time:new Date().getTime()}),t.current=x(n,function(R){e.setState({data:R})}))}}:{}},ie=te,ae=h(41571),ue=h.n(ae),oe=function(e,r){var n=r.debounceWait,i=r.debounceLeading,a=r.debounceTrailing,o=r.debounceMaxWait,s=(0,g.useRef)(),l=(0,g.useMemo)(function(){var c={};return i!==void 0&&(c.leading=i),a!==void 0&&(c.trailing=a),o!==void 0&&(c.maxWait=o),c},[i,a,o]);return(0,g.useEffect)(function(){if(n){var c=e.runAsync.bind(e);return s.current=ue()(function(t){t()},n,l),e.runAsync=function(){for(var t=[],m=0;m<arguments.length;m++)t[m]=arguments[m];return new Promise(function(d,p){var f;(f=s.current)===null||f===void 0||f.call(s,function(){c.apply(void 0,(0,u.ev)([],(0,u.CR)(t),!1)).then(d).catch(p)})})},function(){var t;(t=s.current)===null||t===void 0||t.cancel(),e.runAsync=c}}},[n,l]),n?{onCancel:function(){var c;(c=s.current)===null||c===void 0||c.cancel()}}:{}},se=oe,le=function(e,r){var n=r.loadingDelay,i=r.ready,a=(0,g.useRef)();if(!n)return{};var o=function(){a.current&&clearTimeout(a.current)};return{onBefore:function(){return o(),i!==!1&&(a.current=setTimeout(function(){e.setState({loading:!0})},n)),{loading:!1}},onFinally:function(){o()},onCancel:function(){o()}}},ce=le,M=h(15511);function H(){return M.Z?document.visibilityState!=="hidden":!0}var A=[];function fe(e){return A.push(e),function(){var n=A.indexOf(e);A.splice(n,1)}}if(M.Z){var ve=function(){if(H())for(var e=0;e<A.length;e++){var r=A[e];r()}};window.addEventListener("visibilitychange",ve,!1)}var de=fe,he=function(e,r){var n=r.pollingInterval,i=r.pollingWhenHidden,a=i===void 0?!0:i,o=r.pollingErrorRetryCount,s=o===void 0?-1:o,l=(0,g.useRef)(),c=(0,g.useRef)(),t=(0,g.useRef)(0),m=function(){var d;l.current&&clearTimeout(l.current),(d=c.current)===null||d===void 0||d.call(c)};return(0,F.Z)(function(){n||m()},[n]),n?{onBefore:function(){m()},onError:function(){t.current+=1},onSuccess:function(){t.current=0},onFinally:function(){s===-1||s!==-1&&t.current<=s?l.current=setTimeout(function(){!a&&!H()?c.current=de(function(){e.refresh()}):e.refresh()},n):t.current=0},onCancel:function(){m()}}:{}},me=he;function ge(e,r){var n=!1;return function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];n||(n=!0,e.apply(void 0,(0,u.ev)([],(0,u.CR)(i),!1)),setTimeout(function(){n=!1},r))}}function pe(){return M.Z&&typeof navigator.onLine!="undefined"?navigator.onLine:!0}var S=[];function Re(e){return S.push(e),function(){var n=S.indexOf(e);n>-1&&S.splice(n,1)}}if(M.Z){var V=function(){if(!(!H()||!pe()))for(var e=0;e<S.length;e++){var r=S[e];r()}};window.addEventListener("visibilitychange",V,!1),window.addEventListener("focus",V,!1)}var ye=Re,be=function(e,r){var n=r.refreshOnWindowFocus,i=r.focusTimespan,a=i===void 0?5e3:i,o=(0,g.useRef)(),s=function(){var l;(l=o.current)===null||l===void 0||l.call(o)};return(0,g.useEffect)(function(){if(n){var l=ge(e.refresh.bind(e),a);o.current=ye(function(){l()})}return function(){s()}},[n,a]),(0,B.Z)(function(){s()}),{}},Ce=be,Pe=function(e,r){var n=r.retryInterval,i=r.retryCount,a=(0,g.useRef)(),o=(0,g.useRef)(0),s=(0,g.useRef)(!1);return i?{onBefore:function(){s.current||(o.current=0),s.current=!1,a.current&&clearTimeout(a.current)},onSuccess:function(){o.current=0},onError:function(){if(o.current+=1,i===-1||o.current<=i){var l=n!=null?n:Math.min(1e3*Math.pow(2,o.current),3e4);a.current=setTimeout(function(){s.current=!0,e.refresh()},l)}else o.current=0},onCancel:function(){o.current=0,a.current&&clearTimeout(a.current)}}:{}},Te=Pe,Ee=h(46700),Ae=h.n(Ee),Se=function(e,r){var n=r.throttleWait,i=r.throttleLeading,a=r.throttleTrailing,o=(0,g.useRef)(),s={};return i!==void 0&&(s.leading=i),a!==void 0&&(s.trailing=a),(0,g.useEffect)(function(){if(n){var l=e.runAsync.bind(e);return o.current=Ae()(function(c){c()},n,s),e.runAsync=function(){for(var c=[],t=0;t<arguments.length;t++)c[t]=arguments[t];return new Promise(function(m,d){var p;(p=o.current)===null||p===void 0||p.call(o,function(){l.apply(void 0,(0,u.ev)([],(0,u.CR)(c),!1)).then(m).catch(d)})})},function(){var c;e.runAsync=l,(c=o.current)===null||c===void 0||c.cancel()}}},[n,i,a]),n?{onCancel:function(){var l;(l=o.current)===null||l===void 0||l.cancel()}}:{}},De=Se,Oe=h(30542),T=h(70801),Ze=h(3957),Me=function(){var e=(0,u.CR)((0,g.useState)({}),2),r=e[1];return(0,g.useCallback)(function(){return r({})},[])},je=Me,we=h(37036),Le=h(73680),We=function(){function e(r,n,i,a){a===void 0&&(a={}),this.serviceRef=r,this.options=n,this.subscribe=i,this.initState=a,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=(0,u.pi)((0,u.pi)((0,u.pi)({},this.state),{loading:!n.manual}),a)}return e.prototype.setState=function(r){r===void 0&&(r={}),this.state=(0,u.pi)((0,u.pi)({},this.state),r),this.subscribe()},e.prototype.runPluginHandler=function(r){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var a=this.pluginImpls.map(function(o){var s;return(s=o[r])===null||s===void 0?void 0:s.call.apply(s,(0,u.ev)([o],(0,u.CR)(n),!1))}).filter(Boolean);return Object.assign.apply(Object,(0,u.ev)([{}],(0,u.CR)(a),!1))},e.prototype.runAsync=function(){for(var r,n,i,a,o,s,l,c,t,m,d=[],p=0;p<arguments.length;p++)d[p]=arguments[p];return(0,u.mG)(this,void 0,void 0,function(){var f,v,R,j,N,$,U,w,b,C,J;return(0,u.Jh)(this,function(D){switch(D.label){case 0:if(this.count+=1,f=this.count,v=this.runPluginHandler("onBefore",d),R=v.stopNow,j=R===void 0?!1:R,N=v.returnNow,$=N===void 0?!1:N,U=(0,u._T)(v,["stopNow","returnNow"]),j)return[2,new Promise(function(){})];if(this.setState((0,u.pi)({loading:!0,params:d},U)),$)return[2,Promise.resolve(U.data)];(n=(r=this.options).onBefore)===null||n===void 0||n.call(r,d),D.label=1;case 1:return D.trys.push([1,3,,4]),w=this.runPluginHandler("onRequest",this.serviceRef.current,d).servicePromise,w||(w=(J=this.serviceRef).current.apply(J,(0,u.ev)([],(0,u.CR)(d),!1))),[4,w];case 2:return b=D.sent(),f!==this.count?[2,new Promise(function(){})]:(this.setState({data:b,error:void 0,loading:!1}),(a=(i=this.options).onSuccess)===null||a===void 0||a.call(i,b,d),this.runPluginHandler("onSuccess",b,d),(s=(o=this.options).onFinally)===null||s===void 0||s.call(o,d,b,void 0),f===this.count&&this.runPluginHandler("onFinally",d,b,void 0),[2,b]);case 3:if(C=D.sent(),f!==this.count)return[2,new Promise(function(){})];throw this.setState({error:C,loading:!1}),(c=(l=this.options).onError)===null||c===void 0||c.call(l,C,d),this.runPluginHandler("onError",C,d),(m=(t=this.options).onFinally)===null||m===void 0||m.call(t,d,void 0,C),f===this.count&&this.runPluginHandler("onFinally",d,void 0,C),C;case 4:return[2]}})})},e.prototype.run=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];this.runAsync.apply(this,(0,u.ev)([],(0,u.CR)(n),!1)).catch(function(a){r.options.onError||console.error(a)})},e.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},e.prototype.refresh=function(){this.run.apply(this,(0,u.ev)([],(0,u.CR)(this.state.params||[]),!1))},e.prototype.refreshAsync=function(){return this.runAsync.apply(this,(0,u.ev)([],(0,u.CR)(this.state.params||[]),!1))},e.prototype.mutate=function(r){var n=(0,Le.mf)(r)?r(this.state.data):r;this.runPluginHandler("onMutate",n),this.setState({data:n})},e}(),Fe=We;function Be(e,r,n){r===void 0&&(r={}),n===void 0&&(n=[]);var i=r.manual,a=i===void 0?!1:i,o=(0,u._T)(r,["manual"]);we.Z&&r.defaultParams&&!Array.isArray(r.defaultParams)&&console.warn("expected defaultParams is array, got ".concat(typeof r.defaultParams));var s=(0,u.pi)({manual:a},o),l=(0,Oe.Z)(e),c=je(),t=z(function(){var m=n.map(function(d){var p;return(p=d==null?void 0:d.onInit)===null||p===void 0?void 0:p.call(d,s)}).filter(Boolean);return new Fe(l,s,c,Object.assign.apply(Object,(0,u.ev)([{}],(0,u.CR)(m),!1)))},[]);return t.options=s,t.pluginImpls=n.map(function(m){return m(t,s)}),(0,Ze.Z)(function(){if(!a){var m=t.state.params||r.defaultParams||[];t.run.apply(t,(0,u.ev)([],(0,u.CR)(m),!1))}}),(0,B.Z)(function(){t.cancel()}),{loading:t.state.loading,data:t.state.data,error:t.state.error,params:t.state.params||[],cancel:(0,T.Z)(t.cancel.bind(t)),refresh:(0,T.Z)(t.refresh.bind(t)),refreshAsync:(0,T.Z)(t.refreshAsync.bind(t)),run:(0,T.Z)(t.run.bind(t)),runAsync:(0,T.Z)(t.runAsync.bind(t)),mutate:(0,T.Z)(t.mutate.bind(t))}}var xe=Be;function He(e,r,n){return xe(e,r,(0,u.ev)((0,u.ev)([],(0,u.CR)(n||[]),!1),[se,ce,me,Ce,De,I,ie,Te],!1))}var Ne=He,Ue=Ne,K=h(32648),Ge=function(){var e=Ue(X()(W()().mark(function i(){var a,o;return W()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,fetch("https://ip.useragentinfo.com/json").then(function(c){return c.json()});case 2:return a=l.sent,o=a.short_name,l.abrupt("return",o==="CN");case 5:case"end":return l.stop()}},i)}))),r=e.loading,n=e.data;return(0,K.jsx)("div",{className:"editor",children:!r&&(0,K.jsx)(Y.L7Editor,{baseMap:n?"Gaode":"Mapbox",locale:n?"zh-CN":"en-US",coordConvert:n?"GCJ02":"WGS84",mapControl:n?void 0:{administrativeSelectControl:!1,locationSearchControl:!1,mapAdministrativeControl:!1}})})}},67203:function(Q,E,h){h.r(E);var L=h(17108),W=h(77617),O=h(32648);E.default=function(){return(0,O.jsx)("div",{style:{height:800},children:(0,O.jsx)(L.L7Editor,{})})}}}]);
